{% extends "base.html" %}

{% block title %}League Table - 3. Liga Predictor{% endblock %}

{% block content %}
<div class="header-section">
    <h2>3. Liga Table</h2>
</div>

<div id="loading" class="loading">Loading table...</div>
<div id="error" class="error" style="display: none;"></div>

<div id="table-container">
    <!-- Table will be loaded here -->
</div>

<script>
    async function loadTable() {
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const container = document.getElementById('table-container');

        loading.style.display = 'block';
        error.style.display = 'none';
        container.innerHTML = '';

        try {
            const response = await fetch('/api/table');
            const data = await response.json();

            loading.style.display = 'none';

            if (!data.success) {
                error.textContent = data.error || 'Failed to load table';
                error.style.display = 'block';
                return;
            }

            displayTable(data.table);
        } catch (err) {
            loading.style.display = 'none';
            error.textContent = 'Error loading table: ' + err.message;
            error.style.display = 'block';
        }
    }

    function displayTable(table) {
        const container = document.getElementById('table-container');

        const tableHtml = `
            <table class="league-table">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Team</th>
                        <th>P</th>
                        <th>W</th>
                        <th>D</th>
                        <th>L</th>
                        <th>GF</th>
                        <th>GA</th>
                        <th>GD</th>
                        <th>Pts</th>
                    </tr>
                </thead>
                <tbody>
                    ${table.map(row => `
                        <tr class="position-${row.position <= 3 ? 'promotion' : row.position >= 18 ? 'relegation' : 'normal'}">
                            <td class="position">${row.position}</td>
                            <td class="team-name">${row.team}</td>
                            <td>${row.played}</td>
                            <td>${row.won}</td>
                            <td>${row.drawn}</td>
                            <td>${row.lost}</td>
                            <td>${row.goals_for}</td>
                            <td>${row.goals_against}</td>
                            <td class="${row.goal_difference > 0 ? 'positive' : row.goal_difference < 0 ? 'negative' : ''}">${row.goal_difference > 0 ? '+' : ''}${row.goal_difference}</td>
                            <td class="points"><strong>${row.points}</strong></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
            <div class="table-legend">
                <div class="legend-item">
                    <span class="legend-color promotion"></span>
                    <span>Promotion to 2. Bundesliga</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color relegation"></span>
                    <span>Relegation</span>
                </div>
            </div>
        `;

        container.innerHTML = tableHtml;
    }

    window.onload = loadTable;
</script>
{% endblock %}
