{% extends "base.html" %}

{% block title %}League Table - 3. Liga Predictor{% endblock %}

{% block content %}
<div class="header-section">
    <h2>Current League Table</h2>
</div>

<div id="loading" class="loading">Loading table...</div>
<div id="error" class="error" style="display: none;"></div>

<div id="table-container">
    <table class="league-table">
        <thead>
            <tr>
                <th>Pos</th>
                <th>Team</th>
                <th>P</th>
                <th>W</th>
                <th>D</th>
                <th>L</th>
                <th>GF</th>
                <th>GA</th>
                <th>GD</th>
                <th>Pts</th>
                <th>Form (Last 5)</th>
                <th>EWMA Points</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- Table rows will be inserted here -->
        </tbody>
    </table>
</div>

<script>
    async function loadTable() {
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const tableBody = document.getElementById('table-body');

        loading.style.display = 'block';
        error.style.display = 'none';
        tableBody.innerHTML = '';

        try {
            const response = await fetch('/api/table');
            const data = await response.json();

            loading.style.display = 'none';

            if (!data.success) {
                error.textContent = data.error || 'Failed to load table';
                error.style.display = 'block';
                return;
            }

            displayTable(data.table);
        } catch (err) {
            loading.style.display = 'none';
            error.textContent = 'Error loading table: ' + err.message;
            error.style.display = 'block';
        }
    }

    function displayTable(tableData) {
        const tableBody = document.getElementById('table-body');
        tableData.forEach(team => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${team.position}</td>
                <td class="team-name-cell">${team.team}</td>
                <td>${team.played}</td>
                <td>${team.won}</td>
                <td>${team.drawn}</td>
                <td>${team.lost}</td>
                <td>${team.goals_for}</td>
                <td>${team.goals_against}</td>
                <td>${team.goal_difference}</td>
                <td class="points">${team.points}</td>
                <td>${team.form_last_5}</td>
                <td>${team.ewma_points}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    window.onload = loadTable;
</script>
{% endblock %}
