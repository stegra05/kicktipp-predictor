{% extends "base.html" %}

{% block title %}Statistics - 3. Liga Predictor{% endblock %}

{% block content %}
<div class="header-section">
    <h2>Prediction Performance Statistics</h2>
</div>

<div id="loading" class="loading">Loading statistics...</div>
<div id="error" class="error" style="display: none;"></div>

<div id="stats-container">
    <!-- Statistics will be loaded here -->
</div>

<script>
    async function loadStatistics() {
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const container = document.getElementById('stats-container');

        loading.style.display = 'block';
        error.style.display = 'none';
        container.innerHTML = '';

        try {
            const qualityResponse = await fetch('/api/model_quality');
            const qualityData = await qualityResponse.json();

            loading.style.display = 'none';

            if (!qualityData.success) {
                error.textContent = qualityData.error || 'Failed to load model quality statistics';
                error.style.display = 'block';
                return;
            }

            displayStatistics(qualityData.metrics);
        } catch (err) {
            loading.style.display = 'none';
            error.textContent = 'Error loading statistics: ' + err.message;
            error.style.display = 'block';
        }
    }

    function displayStatistics(metrics) {
        const container = document.getElementById('stats-container');

        let qualityMetricsHtml = '';
        if (metrics) {
            qualityMetricsHtml = `
                <div class="header-section">
                    <h2>Model Quality Metrics</h2>
                </div>
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <h3>Average Points/Match</h3>
                        <div class="stat-value">${(metrics.avg_points ?? 0).toFixed(2)}</div>
                        <div class="stat-label">Projected season: ${((metrics.avg_points ?? 0) * 38).toFixed(1)} pts</div>
                    </div>
                    <div class="stat-card highlight">
                        <h3>Accuracy</h3>
                        <div class="stat-value">${((metrics.accuracy ?? 0) * 100).toFixed(1)}%</div>
                        <div class="stat-label">Share of correct results</div>
                    </div>
                    <div class="stat-card">
                        <h3>Brier Score</h3>
                        <div class="stat-value">${(metrics.brier_score ?? 0).toFixed(3)}</div>
                        <div class="stat-label">Lower is better</div>
                    </div>
                    <div class="stat-card">
                        <h3>Log Loss</h3>
                        <div class="stat-value">${(metrics.log_loss ?? 0).toFixed(3)}</div>
                        <div class="stat-label">Lower is better</div>
                    </div>
                    <div class="stat-card">
                        <h3>Ranked Probability Score</h3>
                        <div class="stat-value">${(metrics.rps ?? 0).toFixed(3)}</div>
                        <div class="stat-label">Lower is better</div>
                    </div>
                </div>
            `;
        }

        container.innerHTML = `
            ${qualityMetricsHtml}

            <div class="header-section">
                <h2>Model Visualizations</h2>
            </div>
            <div class="plots-container">
                <div class="plot">
                    <h3>Confusion Matrix</h3>
                    <img src="/static/plots/confusion_matrix.png" alt="Confusion Matrix">
                </div>
                <div class="plot">
                    <h3>Calibration Curve (Home Win)</h3>
                    <img src="/static/plots/calibration_curve_home.png" alt="Calibration Curve Home Win">
                </div>
                <div class="plot">
                    <h3>Calibration Curve (Draw)</h3>
                    <img src="/static/plots/calibration_curve_draw.png" alt="Calibration Curve Draw">
                </div>
                <div class="plot">
                    <h3>Calibration Curve (Away Win)</h3>
                    <img src="/static/plots/calibration_curve_away.png" alt="Calibration Curve Away Win">
                </div>
            </div>
        `;
    }

    window.onload = loadStatistics;
</script>
{% endblock %}


